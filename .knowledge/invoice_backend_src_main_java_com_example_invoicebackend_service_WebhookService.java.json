{"is_source_file": true, "format": "Java", "description": "This file defines the WebhookService class which handles incoming webhook requests related to invoices and payments, verifies signatures, updates invoice statuses, and publishes outgoing webhooks on status changes. It interacts with repositories and other services, and is part of the application's backend for webhook management.", "external_files": ["com.example.invoicebackend.model.Invoice", "com.example.invoicebackend.model.Partner", "com.example.invoicebackend.model.WebhookSubscription", "com.example.invoicebackend.model.enums.InvoiceStatus", "com.example.invoicebackend.repository.InvoiceRepository", "com.example.invoicebackend.repository.PartnerRepository", "com.example.invoicebackend.repository.WebhookSubscriptionRepository", "com.example.invoicebackend.web.dto.InvoiceDtos", "com.example.invoicebackend.web.dto.WebhookDtos.InvoiceCreatedWebhookRequest", "com.example.invoicebackend.web.dto.WebhookDtos.PaymentUpdatedWebhookRequest", "org.slf4j.Logger", "org.slf4j.LoggerFactory", "org.springframework.beans.factory.annotation.Value", "org.springframework.http.HttpHeaders", "org.springframework.http.MediaType", "org.springframework.stereotype.Service", "org.springframework.transaction.annotation.Transactional", "org.springframework.util.DigestUtils", "org.springframework.web.client.RestClient"], "external_methods": ["DigestUtils.md5DigestAsHex", "RestClient.builder", "RestClient.RequestBodySpec body", "RestClient.RequestBodySpec retrieve", "RestClient.RequestBodySpec toBodilessEntity", "PartnerRepository.findById", "InvoiceRepository.findByPartnerAndInvoiceNumber", "partner.getPartner", "invoice.getStatus", "invoice.setStatus", "invoice.getId", "invoice.getInvoiceNumber", "invoice.getPartner", "participant.getTargetUrl", "subscriptionRepository.findByPartnerAndActiveTrue"], "published": [], "classes": [{"name": "WebhookService", "description": "Service class managing incoming invoice/payment webhooks, verifying signatures, updating records, and dispatching outgoing webhook notifications upon invoice status changes."}], "methods": [{"name": "verifyIncomingSignature", "description": "Verifies the webhook signature; currently a placeholder accepting all signatures unless the secret is configured."}, {"name": "handleInvoiceCreated", "description": "Processes incoming invoice creation webhooks, creating and returning a new invoice record based on request data."}, {"name": "handlePaymentUpdated", "description": "Handles payment status update webhooks, updates invoice status accordingly, ensuring idempotency."}, {"name": "publishInvoiceStatusChange", "description": "Publishes outgoing webhooks notifying about invoice status changes, conditioned on a feature flag."}, {"name": "sendEvent", "description": "Helper method to send an HTTP POST webhook with signature headers."}], "calls": ["DigestUtils.md5DigestAsHex", "RestClient.builder", "RestClient.RequestBodySpec body", "RestClient.RequestBodySpec retrieve", "RestClient.RequestBodySpec toBodilessEntity", "partnerRepository.findById", "invoiceRepository.findByPartnerAndInvoiceNumber"], "search-terms": ["WebhookService", "invoice.status.changed", "verifyIncomingSignature", "handleInvoiceCreated", "handlePaymentUpdated", "publishInvoiceStatusChange", "Webhooks", "invoice", "payment", "status"], "state": 2, "file_id": 75, "knowledge_revision": 170, "git_revision": "", "hash": "83bebfcb5739bc9978793122d3fbf99e", "format-version": 4, "code-base-name": "invoice_backend", "filename": "invoice_backend/src/main/java/com/example/invoicebackend/service/WebhookService.java", "revision_history": [{"170": ""}]}