# Production profile - PostgreSQL via environment variables
# REQUIRED ENV VARIABLES (set these in the container/platform environment):
# - DB_URL:      JDBC URL, e.g., jdbc:postgresql://db-host:5432/invoice_db
# - DB_USERNAME: Database user
# - DB_PASSWORD: Database password
# - DB_SCHEMA:   Schema to use (e.g., public or app-specific)
# - DB_POOL_SIZE: Optional Hikari pool size (e.g., 10). Defaults applied if unset.

spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driverClassName=org.postgresql.Driver

# Connection pool (Hikari)
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${DB_POOL_SIZE:10}
spring.datasource.hikari.pool-name=InvoiceHikariCP

# JPA
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.properties.hibernate.default_schema=${DB_SCHEMA}
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# Flyway targets the same schema configured via env
spring.flyway.enabled=true
spring.flyway.schemas=${DB_SCHEMA}
spring.flyway.default-schema=${DB_SCHEMA}
spring.flyway.placeholders.app_schema=${DB_SCHEMA}

# Actuator & OpenAPI (kept available)
management.endpoints.web.exposure.include=health,info,metrics
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html

# Forwarded headers
server.forward-headers-strategy=framework

# Storage provider selection (defaults to local if not set)
app.storage.provider=${STORAGE_PROVIDER:local}
app.storage.local.path=${STORAGE_LOCAL_PATH:attachments}
# S3 settings (only used if STORAGE_PROVIDER=s3)
app.storage.s3.bucket=${S3_BUCKET:}
app.storage.s3.region=${S3_REGION:}
app.storage.s3.accessKey=${S3_ACCESS_KEY:}
app.storage.s3.secretKey=${S3_SECRET_KEY:}
# Azure settings (only used if STORAGE_PROVIDER=azure)
app.storage.azure.connection=${AZURE_CONN:}
